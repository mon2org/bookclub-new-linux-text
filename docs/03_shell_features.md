---
title: "第03章 シェルの便利な機能"
date: ""
draft: true
---

# 第03章 シェルの便利な機能

## 要点

### コマンドライン編集：迅速なテキスト操作

コマンドラインでの入力作業を効率化するため、シェルには豊富な編集機能が備わっている。

#### カーソル移動

- 文字単位、単語単位、行単位での迅速なカーソル移動が可能。
- キーボードのホームポジションから手を大きく動かす必要があるカーソルキーの使用は推奨されない。

| 操作内容 | ショートカットキー |	説明 |
|---|---|---|
| 1文字後方へ移動 |	<kbd><kbd>Ctrl</kbd> + <kbd>B</kbd></kbd> | BackwardのB。|
| 1文字前方へ移動 | <kbd><kbd>Ctrl</kbd> + <kbd>F</kbd></kbd> | ForwardのF。|
| 行頭へ移動 | <kbd><kbd>Ctrl</kbd> + <kbd>A</kbd></kbd> |  |
| 行末へ移動 | <kbd><kbd>Ctrl</kbd> + <kbd>E</kbd></kbd> | EndのE。コマンド実行時、カーソルは行末にある必要はない。|
| 1単語後方へ移動 | <kbd><kbd>Alt</kbd> + <kbd>B</kbd></kbd> または <kbd><kbd>Esc</kbd> + <kbd>B</kbd></kbd> | Metaキーを利用した操作。|
| 1単語前方へ移動 | <kbd><kbd>Alt</kbd> + <kbd>F</kbd></kbd> または <kbd><kbd>Esc</kbd> + <kbd>F</kbd></kbd>  |  |

#### 文字と単語の削除

入力ミスを修正するための削除機能も複数用意されている。

| 操作内容 | ショートカットキー | 説明 |
|---|---|---|
| カーソル前の1文字を削除 | Backspace または <kbd><kbd>Ctrl</kbd> + <kbd>H</kbd></kbd> | 一般的なバックスペース操作。|
| カーソル位置の1文字を削除 | Delete または <kbd><kbd>Ctrl</kbd> + <kbd>D</kbd></kbd> | カーソル位置の文字を削除する。|
| カーソル前の1単語を削除 | <kbd><kbd>Ctrl</kbd> + <kbd>W</kbd></kbd> | 単語単位での後方削除。|

1.3 カット＆ヤンク（ペースト）

単なる削除ではなく、テキストを一時的に保持して再利用する「カット＆ペースト」に相当する機能も存在する。

Bashでは、ペースト操作を「ヤンク」と呼ぶ。

| 操作内容 | ショートカットキー | 説明 |
|---|---|---|
| カーソル位置から行末までをカット | <kbd><kbd>Ctrl</kbd> + <kbd>K</kbd></kbd> |  |
| カーソル位置から行頭までをカット | <kbd><kbd>Ctrl</kbd> + <kbd>U</kbd></kbd> | 入力したコマンドライン全体を削除する際にも利用できる。|
| 最後にカットした内容を挿入 | <kbd><kbd>Ctrl</kbd> + <kbd>Y</kbd></kbd> | ヤンク（ペースト）操作。Ctrl+KやCtrl+Uでカットした内容を貼り付ける。|


#### 補完機能：入力ミスの削減と効率向上

長いコマンド名やファイル名をすべて手入力するのは非効率であり、タイプミスの原因となる。シェルの補完機能は、Tabキーを押すだけで入力中の文字列から候補を推測し、自動的に補完する仕組みである。

* 機能概要: コマンド名やファイル名の最初の数文字を入力した後にTabキーを押すことで、残りを自動入力する。これにより、入力の手間が省けるだけでなく、人為的なタイプミスを根本的に防ぐことができる。
* 操作方法:
  * 候補が1つの場合: Tabキーを押すと、即座にコマンド名が補完される。（例：ecと入力後Tab → echo）
  * 候補が複数の場合: 1回目のTabキーでは警告音が鳴るか無反応に見える。続けてもう一度Tabキーを押すと、保管候補の一覧が表示される。


#### コマンド履歴：過去の操作の再利用

- Bashは一度実行したコマンドを「コマンド履歴」として自動的に記録している。
- これにより、過去のコマンドを再度手で打ち直すことなく、簡単に呼び出して再実行したり、修正して利用したりすることが可能である。

#### 履歴の呼び出し

直前のコマンドやさらに過去のコマンドを順に呼び出すことができる。

| 操作内容 | ショートカットキー | 説明 |
|---|---|---|
| 1つ前の履歴へ移動 | Ctrl + P または ↑ (上矢印) | PreviousのP。|
| 1つ先の履歴へ移動 | Ctrl + N または ↓ (下矢印) | NextのN。|

#### インクリメンタル検索

コマンド履歴が膨大になった場合、目的のコマンドを一つずつ遡って探すのは非効率である。<kbd><kbd>Ctrl</kbd> + <kbd>R</kbd></kbd>を使用することで、履歴を遡りながら検索する「インクリメンタル検索」モードに移行する。

* 機能概要: 1文字入力するごとに、その文字列を含む履歴がリアルタイムで検索・表示される「逐次検索」方式。
* 検索モード中の主要な操作:

| 操作内容 | ショートカットキー |
|---|---|
| さらに前の検索結果へ移動 | <kbd><kbd>Ctrl</kbd> + <kbd>R</kbd></kbd> |
| 現在の検索結果を実行 | <kbd>Enter</kbd> |
| 現在の検索結果をコマンドラインに表示して編集モードに戻る | <kbd>←</kbd> or <kbd>→</kbd> (左右矢印) |
| 検索を中止してプロンプトに戻る | <kbd><kbd>Ctrl</kbd> + <kbd>G</kbd></kbd> |

#### トラブルシューティング：一般的な問題への対処法

- CLI操作に不慣れなうちは、予期せぬ状態に陥ることがある。
- その多くは単純な操作ミスが原因であり、以下の方法で解決できる。

| 現象 | 原因 | 対処法 |
|---|---|---|
| キーボード入力を一切受け付けない | Ctrl + S (画面表示のロック)を誤って押した。 | Ctrl + Q を押してロックを解除する。 |
| コマンドが終了せず、プロンプトが返ってこない | pingコマンドのように、明示的に終了させないと動き続けるコマンドを実行している。 | Ctrl + C を押して実行中のコマンドを強制終了させる。 |
| プロンプトが文字化けした | バイナリファイルを表示させるなどして端末の表示が乱れた。 | 1. Ctrl + L または clear コマンドで画面を消去する。<br>2. 改善しない場合は reset コマンドで端末を初期化する。<br>3. それでも治らない場合は、ターミナルを再起動するか再ログインする。 |

- 備考: Ctrl+Cは、実行中のプロセスを強制終了させるだけでなく、「コマンドラインの途中まで入力したところで入力内容の誤りに気がついた時に、現在の入力内容を破棄して新しいコマンドラインに移る」ためにも使用できる。

### 補足：文字コードの基礎知識

* 概要: コンピュータ内部では文字が数値（バイト列）で表現されており、その対応ルールが「文字コード」である。歴史的に日本語環境ではEUC-JPなど複数の規格が存在し、文字化けの一因となっていた。
* 現在の標準: 現在のLinux環境ではUnicode (UTF-8)がほぼ標準となっており、通常はこの設定で問題は発生しない。
* 設定確認: 自身の環境の文字コード設定は、printenv LANGコマンドで確認できる。日本語UTF-8環境ではja_JP.UTF-8のように表示される。
* コード変換: 文字コードを変換する必要がある場合はiconvコマンドが利用できる。例えば、EUC-JPからUTF-8への変換は iconv -f EUC-JP -t UTF-8 [ファイル名] のように実行する。

***
[🔙 ](./README.md)
